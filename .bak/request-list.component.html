<div class="request-list-container">
  <h3>{{ role === 'admin' ? 'ðŸ“‹ Semua Pengajuan' : 'ðŸ“‹ Pengajuan Saya' }}</h3>

  <div *ngIf="requests.length === 0" class="empty-state">
    <p>{{ role === 'admin' ? 'Belum ada pengajuan dari user.' : 'Anda belum memiliki pengajuan.' }}</p>
  </div>

  <div class="request-cards">
    <table datatable [dtOptions]="dtOptions" class="table table-striped table-bordered w-100">
      <thead>
        <tr>
          <th>Judul</th>
          <th>Deskripsi</th>
          <!-- Kolom tambahan untuk admin -->
          <th *ngIf="role === 'admin'">Diajukan Oleh</th>
          <th>Status</th>
          <th>Dibuat</th>
          <!-- Kolom aksi hanya untuk admin -->
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let req of requests">
          <td>{{ req.title }}</td>
          <td>{{ req.description }}</td>
          
          <!-- Info user (hanya admin yang lihat) -->
          <td *ngIf="role === 'admin'">
            {{ req.userId?.username || 'Unknown' }}
          </td>
          
          <td>
            <span [class]="getStatusBadgeClass(req.status)">
              <i [class]="'bi ' + getStatusIcon(req.status) + ' me-1'"></i>
              {{ getStatusText(req.status) }}
            </span>
          </td>
          
          <td>{{ req.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          
          <!-- Tombol aksi (hanya admin yang lihat, dan hanya untuk status pending) -->
          <td *ngIf="role === 'admin'">
            <div *ngIf="req.status === 'pending'; else alreadyProcessed">
              <button class="btn btn-success btn-sm me-2" (click)="approveRequest(req._id)">
                <i class="bi bi-check-circle"></i> Setujui
              </button>
              <button class="btn btn-danger btn-sm" (click)="rejectRequest(req._id)">
                <i class="bi bi-x-circle"></i> Tolak
              </button>
            </div>
            <ng-template #alreadyProcessed>
              <span class="text-muted">
                <em>{{ req.status === 'approved' ? 'Sudah disetujui' : 'Sudah ditolak' }}</em>
              </span>
            </ng-template>
          </td>

          <!-- ðŸ†• Tombol aksi untuk USER (Edit & Delete hanya pending) -->
          <td *ngIf="role === 'user'">
            <div *ngIf="req.status === 'pending'; else cannotEdit">
              <button class="btn btn-primary btn-sm me-2" (click)="editRequest(req)">
                <i class="bi bi-pencil"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteRequest(req._id)">
                <i class="bi bi-trash"></i> Hapus
              </button>
            </div>
            <ng-template #cannotEdit>
              <span class="text-muted">
                <em>{{ req.status === 'approved' ? 'Sudah disetujui' : 'Sudah ditolak' }}</em>
              </span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>